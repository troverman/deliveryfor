{{extend 'layout.html'}}
<style>
    tr#ratings_id__row{display:none;}
    label#rating_votes_rating_vote__label{display:none;}
    tr#rating_votes_id__row{display:none;}
    tr#location_item_id__row{display:none;}
    tr#location_category_id__row{display:none;}
    tr#location_item_options_id__row{display:none;}
    a{cursor:pointer;}
    a:hover{text-decoration:none;}
    hr {margin: 0px;}
</style>
<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script src="{{=URL('static','js/gmaps.js')}}"></script>
<script>   
  $(document).ready(function(){                                                         
  map = new GMaps({
  {{lat_sum=0}}
  {{lng_sum=0}}
  {{counting = 0}}
  {{for latlng in lat_lng_array:}}
    {{counting = counting + 1}}
    {{lat_sum=lat_sum + latlng[0]}}
    {{lng_sum=lng_sum + latlng[1]}}                                        
  {{pass}}
          
  {{if len(lat_lng_array) == 0:}}   
    {{lng_avg = 0}}
    {{lat_avg = 0}}
  {{else:}}
    {{lng_avg = lng_sum / counting}}
    {{lat_avg = lat_sum / counting}}      
  {{pass}}
  div: '#map',
  //zoom:7, 
  lat:{{=lat_avg}},
  lng:{{=lng_avg}}    
  }); 
                     
{{import random}}       
{{for lat_lng in lat_lng_array:}}
      map.addMarker({
      lat: {{=lat_lng[0]}},
      lng: {{=lat_lng[1]}},
      title: '{{=lat_lng[4]}}',
      infoWindow: { 
      content: '<div class = "MarkerPopUp" style="width: 400px;height:250px;"><div class = "MarkerContext">\
      <a href="/member/{{=lat_lng[4]}}">{{=lat_lng[4]}}</a><hr>\
      <table><tr><td>{{if lat_lng[3]:}}<img src="{{=URL('download',args=lat_lng[3][random.randint(0,len(lat_lng[3])-1)])}}" style="height:64px;" class="img-polaroid" />{{pass}}</td>\
      <td>{{=lat_lng[2]}}</td></tr></table>\
      </div></div>'
      }
      });
      map.drawCircle({
      lat: {{=lat_lng[0]}},
      lng: {{=lat_lng[1]}},
      radius: 1000   
      });
    {{pass}} 
  map.fitZoom();
  }); 
</script>      

<div style="border-bottom:4px solid rgb(51,102,153);">
    <div style="width:100%; height:300px;border-bottom:4px solid rgb(51,51,51);border-bottom:100px soild rgb(255,255,255)" id="map" ></div>   
</div>

<div style="margin-left:5%;margin-right:5%;">
    {{if session.search_history:}}
        <a href="/search/{{=session.search_history}}">return to search</a>
    {{pass}}
    
    <div style="margin-left:10px;">
    	<br><h1>{{=location_from_url[0]['name']}}</h1><hr><br>
	<div id="location-image">
   		 
		{{for picture in location_picture_array:}}
    		<a href="#"><img src="{{=URL('download',args=picture['picture'])}}" style="height:128px;" class="img-polaroid" /></a>
        {{pass}}
   		 
    </div>	
    	
<div id="location-top-block" style="margin-left:15px;">
	<br>   
    <p class="lead">
	{{tag_array = db(db.location_tag.location_id == location_from_url[0]['id']).select()}}
    {{for count, tag in enumerate(tag_array):}}
        <a href="/tags/{{=tag['tag']}}/">{{=tag['tag']}}</a>
        {{if count != len(tag_array) - 1:}},
        {{pass}}
    {{pass}}
    </p>
	<p class="lead">{{=location_from_url[0]['description']}}</p>
    <p class="lead">open / closed (hours) / x available drivers</p>
    <h3><a id="details-expand">details<b class="caret" id="user-caret" style=""></b><i class="icon-list" style="margin-left:10px;margin-top:10px;"></i></a></h3><hr>	
    <div id="details-form" style="margin-left:15px;">    
		<h4><a id="information-expand">information<b class="caret" id="user-caret" style=""></b><i class="icon-info-sign" style="margin-left:10px;margin-top:6px;"></i></a></h4><hr>
        <div id="information-form"><br>       
            <div style="margin-left:15px">
                <p class="lead">{{=location_from_url[0]['description']}}</p>
				<p class="lead">hours of operation</p>
                <p class="lead">{{=location_from_url[0]['phone_number']}}</p>
                <p class="lead">{{=location_from_url[0]['address']}}</p>
				<p class="lead">{{=location_from_url[0]['city']}}, {{=location_from_url[0]['location_state']}} {{=location_from_url[0]['zipcode']}}</p>
            </div> 
            <hr>
            <br>                             
        </div>	 	                  
		<h4><a id="ratings-expand">ratings<b class="caret" id="user-caret" style=""></b><i class="icon-star-empty" style="margin-left:10px;margin-top:6px;"></i></a></h4><hr>
		<div id="ratings-form">
                                                                                     
        </div>
                 
                 
			<h4><a id="stats-expand">stats<b class="caret" id="user-caret" style=""></b><i class="icon-signal" style="margin-left:10px;margin-top:6px;"></i></a></h4><hr>
      			<div id="stats-form"><br>
        			<div style="margin-left:15px">
        				stats
                    </div>
        			<hr><br>	
        		</div>
				<h4><a id="available-delivery-members-expand">available delivery members<b class="caret" id="user-caret" style=""></b><i class="icon-user" style="margin-left:10px;margin-top:6px;"></i></a></h4><hr>
				<div id="available-delivery-members-form"><br>
                    <div style="margin-left:15px">
                    	{{for member in available_member_array:}}
                        	<a href="/member/{{=db(db.auth_user.id == member['id']).select()[0]['username']}}">{{=db(db.auth_user.id == member['id']).select()[0]['username']}}</a><br>
    						{{=member['current_location']}}<br>
    						{{=member['delivery_radius']}}<br>
							{{=member['home']}}<br>
							{{=member['max_radius_from_home']}}<br>
							ratings<br>
							average<br>
							<br><br>
						{{pass}}
                    </div>
        		<hr><br>
        		</div>
				
				<h4><a id="admin-settings-expand">admin settings<b class="caret" id="user-caret" style=""></b><i class="icon-eye-open" style="margin-left:10px;margin-top:6px;"></i></a></h4><hr>
				<div id="admin-settings-form"><br>
				
                    <div style="margin-left:15px">
                        admin users
                        official delivery users
                    </div>
                    
                    <hr><br>
        		</div>
        	</div>        

</div>        
   
<h3><a id="deals-coupons-expand">deals and coupons<b class="caret" id="user-caret" style=""></b><i class="icon-tags" style="margin-left:10px;margin-top:10px;"></i></a></h3><hr><br>
    
    <div id="deals-coupons-form">
      
    <div style="margin-left:15px;">
    
    	deals and coupons
    
    </div>        
          
    <hr><br>    
    </div>                                                                  
                                                                                       
<h2><a id="items-expand">items<b class="caret" id="user-caret" style=""></b><i class="icon-align-justify" style="margin-left:10px;margin-top:16px;"></i></a></h2><hr>
			
<div id="items-form" style="margin-left:15px;">
<br> 
</div>




<script>
        
        $("#ratings-form").show("slow");
        $("#ratings-form").hide();
        $("#ratings-expand").click(function () {
        $("#ratings-form").slideToggle();});
                
        $("#new-item-form").show("slow");
        $("#new-item-form").hide();
        $("#new-item").click(function () {
        $("#new-category-form").hide();
        $("#new-item-form").slideToggle();});       
        
        $("#available-delivery-membersform").show("slow");
        $("#available-delivery-members-form").hide();
        $("#available-delivery-members-expand").click(function () {
        $("#available-delivery-members-form").slideToggle();});
                
        $("#admin-settings-form").show("slow");
        $("#admin-settings-form").hide();
        $("#admin-settings-expand").click(function () {
        $("#admin-settings-form").slideToggle();});
        
        $("#details-form").show("slow");
        $("#details-expand").click(function () {
        $("#details-form").slideToggle();});
        
        $("#information-form").show("slow");
        $("#information-form").hide();
        $("#information-expand").click(function () {
        $("#information-form").slideToggle();});
        
        $("#items-form").show("slow");
        $("#items-expand").click(function () {
        $("#items-form").slideToggle();});
        
        $("#stats-form").show("slow");
        $("#stats-form").hide();
        $("#stats-expand").click(function () {
        $("#stats-form").slideToggle();});
        
        $("#deals-coupons-form").show("slow");
        $("#deals-coupons-form").hide();
        $("#deals-coupons-expand").click(function () {
        $("#deals-coupons-form").slideToggle();});
        
</script>
