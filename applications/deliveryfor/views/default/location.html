{{extend 'layout.html'}}
<style>
    tr#ratings_id__row{display:none;}
    label#rating_votes_rating_vote__label{display:none;}
    tr#rating_votes_id__row{display:none;}
    tr#location_item_id__row{display:none;}
    tr#location_category_id__row{display:none;}
    tr#location_item_options_id__row{display:none;}
    a{cursor:pointer;}
    a:hover{text-decoration:none;}
    hr {margin: 0px;}
    #item-block-list-container{text-align:center;width:100%;}
    #item-block-list-item{border:2px solid rgb(210,210,210);display:inline-block;padding:10px;margin:7px;}
    #item-block-list-item:hover{border:2px solid rgb(110,110,110);display:inline-block;padding:11px;margin:7px;background-color:rgb(255,255,255);}
</style>
<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script src="{{=URL('static','js/gmaps.js')}}"></script>
<script>   
$(document).ready(function(){                                                         
  map = new GMaps({
    {{lat_sum=0}}
    {{lng_sum=0}}
    {{for counting, latlng in enumerate(lat_lng_array_member):}}
      {{lat_sum=lat_sum + latlng[0]}}
      {{lng_sum=lng_sum + latlng[1]}}                                        
    {{pass}}
    {{if len(lat_lng_array_member) != 0:}}
      {{lng_avg = lng_sum / len(lat_lng_array_member)}}
      {{lat_avg = lat_sum / len(lat_lng_array_member)}}    
    {{else:}}
      {{lat_avg = 0.00}}
      {{lng_avg = 0.00}}
    {{pass}}

    div: '#map',
    //zoom:7, 
    lat:{{=lat_avg}},
    lng:{{=lng_avg}}    
  }); 
                     
  {{import random}}       
  {{for lat_lng in lat_lng_array_location:}}
        map.addMarker({
        lat: {{=lat_lng[0]}},
        lng: {{=lat_lng[1]}},
        title: '{{=lat_lng[4]}}',
        infoWindow: { 
        content: '<div class = "MarkerPopUp" style="width: 400px;height:250px;"><div class = "MarkerContext">\
        <a href="/member/{{=lat_lng[4]}}/">{{=lat_lng[4]}}</a><hr>\
        <table><tr><td>{{if lat_lng[3]:}}<img src="{{=URL('download',args=lat_lng[3][random.randint(0,len(lat_lng[3])-1)])}}" style="height:64px;" class="img-polaroid" />{{pass}}</td>\
        <td>{{=lat_lng[2]}}</td></tr></table>\
        </div></div>'
        }
        });
        map.drawCircle({
        lat: {{=lat_lng[0]}},
        lng: {{=lat_lng[1]}},
        radius: {{=lat_lng[5]}}   
        });
  {{pass}}
  {{for lat_lng in lat_lng_array_member:}}
        map.addMarker({
        lat: {{=lat_lng[0]}},
        lng: {{=lat_lng[1]}},
        title: '{{=lat_lng[4]}}',
        infoWindow: { 
        content: '<div class = "MarkerPopUp" style="width: 400px;height:250px;"><div class = "MarkerContext">\
        <a href="/member/{{=lat_lng[4]}}/">{{=lat_lng[4]}}</a><hr>\
        <table><tr><td>{{if lat_lng[3]:}}<img src="{{=URL('download',args=lat_lng[3][random.randint(0,len(lat_lng[3])-1)])}}" style="height:64px;" class="img-polaroid" />{{pass}}</td>\
        <td>{{=lat_lng[2]}}</td></tr></table>\
        </div></div>'
        }
        });
        map.drawCircle({
        lat: {{=lat_lng[0]}},
        lng: {{=lat_lng[1]}},
        radius: {{=lat_lng[5]}}   
        });
  {{pass}} 
  map.fitZoom();
}); 
</script>      

<div style="border-bottom:4px solid rgb(51,102,153);">
    <div style="width:100%; height:300px;border-bottom:4px solid rgb(51,51,51);border-bottom:100px soild rgb(255,255,255)" id="map" ></div>   
</div>
<div style="float:right;position:fixed;left:80%;max-height:400px;" class="well">
  {{for member in member_orders_from_location:}}
    {{=member['member_id']}}<br>
  {{pass}}
  {{for x in range(2):}}
    <a href="">+</a><a href="">x</a><a href="">-</a>
    <p class="lead">item title</p>
    <p class="lead">item description</p>
    <p class="lead">delivery member</p>
    <p class="lead">price(s)</p>
  {{pass}}
  <hr>
  <p class="btn"><a href="/orders/">continue</a></p>
</div>
<div style="margin-left:5%;margin-right:5%;">
    {{if session.search_history:}}
        <a href="/search/{{=session.search_history}}">return to search</a>
    {{pass}}
    
    <div style="margin-left:10px;">
    	<br><h1>{{=location_from_url[0]['name']}}</h1>
      <i class="fa fa-star-o"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i><i class="fa fa-star-o"></i>
      <a id="available-delivery-members-anchor" href="#available-delivery-members-expand"><i class="icon-user" style="margin-left:10px;margin-top:6px;"></i>({{=len(available_member_array)}})</a>
      <p class="lead"><span style="color:rgb(0,100,0);">open</span> / <span style="color:rgb(100,50,0);">closed</span></p>
      <hr><br>

	<div id="location-image">
   		 
		  {{for picture in location_picture_array:}}
    		<a href="#"><img src="{{=URL('download',args=picture['picture'])}}" style="height:128px;" class="img-polaroid" /></a>
      {{pass}}
   		 
    </div>	
    	
<div id="location-top-block" style="margin-left:15px;">
	<br>   
    <p class="lead">
	{{tag_array = db(db.location_tag.location_id == location_from_url[0]['id']).select()}}
    {{for count, tag in enumerate(tag_array):}}
        <a href="/tags/{{=tag['tag']}}/">{{=tag['tag']}}</a>
        {{if count != len(tag_array) - 1:}},
        {{pass}}
    {{pass}}
    </p>
	<p class="lead">{{=location_from_url[0]['description']}}</p>

    <h3><a id="details-expand">details<b class="caret" id="user-caret" style=""></b><i class="icon-list" style="margin-left:10px;margin-top:10px;"></i></a></h3><hr>	
    <div id="details-form" style="margin-left:15px;">    
		<h4><a id="information-expand">information<b class="caret" id="user-caret" style=""></b><i class="icon-info-sign" style="margin-left:10px;margin-top:6px;"></i></a></h4><hr>
        <div id="information-form"><br>       
            <div style="margin-left:15px">
                <p class="lead">{{=location_from_url[0]['description']}}</p>
				<p class="lead">hours of operation</p>
                <p class="lead">{{=location_from_url[0]['phone_number']}}</p>
                <p class="lead">{{=location_from_url[0]['address']}}</p>
				<p class="lead">{{=location_from_url[0]['city']}}, {{=location_from_url[0]['location_state']}} {{=location_from_url[0]['zipcode']}}</p>
            </div> 
            <hr>
            <br>                             
        </div>	 	                  
		<h4><a id="ratings-expand">ratings<b class="caret" id="user-caret" style=""></b><i class="icon-star-empty" style="margin-left:10px;margin-top:6px;"></i></a></h4><hr>
		<div id="ratings-form">
    </div>
                 
                 
			<h4><a id="stats-expand">stats<b class="caret" id="user-caret" style=""></b><i class="icon-signal" style="margin-left:10px;margin-top:6px;"></i></a></h4><hr>
      <div id="stats-form"><br>
        <div style="margin-left:15px">
          deliveryies / time<br>
          most popular item<br>
          cash per time<br>
          average delivery member saturation<br>
          most popular times<br>



        </div>
        <hr><br>	
      </div>
				<h4><a id="available-delivery-members-expand">available delivery members<b class="caret" id="user-caret" style=""></b><i class="icon-user" style="margin-left:10px;margin-top:6px;"></i>({{=len(available_member_array)}})</a></h4><hr>
				<div id="available-delivery-members-form"><br>
          <div style="margin-left:15px">
            {{for member in available_member_array:}}
              <a href="/member/{{=db(db.auth_user.id == member['user_id']).select()[0]['username']}}/">{{=db(db.auth_user.id == member['user_id']).select()[0]['username']}}</a><br>
              {{=member['current_location']}}<br>
              {{=member['delivery_radius']}}<br>
              {{=member['home']}}<br>
              {{=member['max_radius_from_home']}}<br>
              ratings<br>
              average<br>
              <br><br>
            {{pass}}
          </div>
          <hr><br>
        </div>
				
        {{the_variable = 'true'}}
        {{if the_variable == 'true':}}
				<h4><a id="admin-settings-expand">admin settings<b class="caret" id="user-caret" style=""></b><i class="icon-eye-open" style="margin-left:10px;margin-top:6px;"></i></a></h4><hr>
				<div id="admin-settings-form"><br>
          <div style="margin-left:15px">
            admin users
            official delivery users
          </div>
          <hr><br>
          </div>
        </div>  
        {{pass}}      
</div>        
   
    <h3><a id="deals-coupons-expand">deals and coupons<b class="caret" id="user-caret" style=""></b><i class="icon-tags" style="margin-left:10px;margin-top:10px;"></i></a></h3><hr><br>
    <div id="deals-coupons-form">
      <div style="margin-left:15px;">
      	deals and coupons
      </div>        
      <hr><br>    
    </div>                                                                  
                                                                                       
<h2><a id="items-expand">items<b class="caret" id="user-caret" style=""></b><i class="icon-align-justify" style="margin-left:10px;margin-top:16px;"></i></a></h2><hr>
<div id="items-form" style="margin-left:15px;">

  <div class="dropdown" style="float:right;margin-right:15px;">
    <a class="dropdown-toggle" data-toggle="dropdown" href="#">sort by: <b style="margin-left:5px;"class="caret"></b></a>
    <ul class="dropdown-menu pull-right" style="left:auto;width:158px;min-width:0px;" role="menu" aria-labelledby="dLabel">
      <li><a tabindex="-1" href="#">most recent</a></li>
      <li><a tabindex="-1" href="#">relevancy</a></li>
      <li><a tabindex="-1" href="#">highest price</a></li>
      <li><a tabindex="-1" href="#">lowest price</a></li>
    </ul>
  </div>
  <div class="btn-toolbar" style="margin-left:15px;float:left;">
    <div class="btn-group">
      <a class="btn active" id="view-list"><i class="icon-align-justify"></i></a>
      <a class="btn" id="view-table"><i class="icon-th"></i></a>
    </div>
  </div>

  <hr>
  <br>
  <br>

  <br>
  <br>
  <br>

<div id="item-list-container" style="">
  {{for item in items_from_location:}}
    <div class="add-item" id="add-item-{{=location_from_url[0]['id']}}" style="float:left;margin-right:10px;">
      <form style="display:none"><input type="hidden" id="" name="location_id" value="{{=location_from_url[0]['id']}}" /></form> 
      <form style="display:none"><input type="hidden" id="" name="item_id" value="{{=item['id']}}" /></form> 

      <a data-toggle="modal" href="#add-tiem" onclick="ajax('/ajax_add_item_to_order/', ['location_id'], ':eval');">
        <h5 class="btn">add item to order</h5>      
      </a>
    </div>
    <a>{{=item['title']}}</a><br>
    <a>{{=db(db.location_item_option.location_item_id == item['id']).select()}}</a>
    <br>

  <div class="modal fade" id="add-item" style="display:none;">
    <div class="modal-header" id="add-item-header">
      <a class="close" data-dismiss="modal">×</a>
      <h3>add {{=item['title']}}</h3>
    </div>
    <br>
    <div class="modal-body" style="">
      available delivery drivers.... select one bro
    </div>
    <div class="modal-footer">
    </div>
  </div>
  {{pass}}
</div>

<div id="item-block-list-container" style="display:none;">
  {{for item in items_from_location:}}
    <div id="item-block-list-item">
      <div class="add-item" id="add-item-{{=location_from_url[0]['id']}}" style="float:left;margin-right:10px;">
        <form style="display:none"><input type="hidden" id="" name="location_id" value="{{=location_from_url[0]['id']}}" /></form> 
        <form style="display:none"><input type="hidden" id="" name="item_id" value="{{=item['id']}}" /></form> 

        <a data-toggle="modal" href="#add-tiem" onclick="ajax('/ajax_add_item_to_order/', ['location_id'], ':eval');">
          <h5 class="btn">add item to order</h5>      
        </a>
      </div>
      <a>{{=item['title']}}</a><br>
      <a>{{=db(db.location_item_option.location_item_id == item['id']).select()}}</a>
      <br>
    </div>
  {{pass}}
</div>




  <br><br><br>
  
  <br> 
</div>


<br>
<br>
<br>
<br>


<script>
    $("#view-list").click(function() {
        if ($(this).hasClass("active")){}
        else{
            $(this).addClass("active");
            $("#view-table").removeClass("active");
            $("#item-block-list-container").fadeToggle(); 
            $("#item-list-container").fadeToggle();
        }
    });
    $("#view-table").click(function() {
        if ($(this).hasClass("active")){}
        else{
            $(this).addClass("active");
            $("#view-list").removeClass("active");
            $("#item-block-list-container").fadeToggle(); 
            $("#item-list-container").fadeToggle();
        }
    });
        $("#add-item").draggable({handle:"#add-item-header", cursor:"move"}); 

        $("#ratings-form").show("slow");
        $("#ratings-form").hide();
        $("#ratings-expand").click(function () {
        $("#ratings-form").slideToggle();});
                
        $("#new-item-form").show("slow");
        $("#new-item-form").hide();
        $("#new-item").click(function () {
        $("#new-category-form").hide();
        $("#new-item-form").slideToggle();});       
        
        $("#available-delivery-membersform").show("slow");
        $("#available-delivery-members-form").hide();
        $("#available-delivery-members-expand").click(function () {
        $("#available-delivery-members-form").slideToggle();});

        $("#available-delivery-members-anchor").click(function () {
        $("#available-delivery-members-form").slideToggle();});
                
        $("#admin-settings-form").show("slow");
        $("#admin-settings-form").hide();
        $("#admin-settings-expand").click(function () {
        $("#admin-settings-form").slideToggle();});
        
        $("#details-form").show("slow");
        $("#details-expand").click(function () {
        $("#details-form").slideToggle();});
        
        $("#information-form").show("slow");
        $("#information-form").hide();
        $("#information-expand").click(function () {
        $("#information-form").slideToggle();});
        
        $("#items-form").show("slow");
        $("#items-expand").click(function () {
        $("#items-form").slideToggle();});
        
        $("#stats-form").show("slow");
        $("#stats-form").hide();
        $("#stats-expand").click(function () {
        $("#stats-form").slideToggle();});
        
        $("#deals-coupons-form").show("slow");
        $("#deals-coupons-form").hide();
        $("#deals-coupons-expand").click(function () {
        $("#deals-coupons-form").slideToggle();});
        
</script>
